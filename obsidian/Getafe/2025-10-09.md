# BBDD

## DISTINCT en SQL

`DISTINCT` se utiliza en una consulta `SELECT` para **eliminar filas duplicadas** y mostrar solo valores únicos.

### Uso básico

```sql
SELECT DISTINCT columna1, columna2
FROM tabla;
```

### Ejemplo

Si una tabla tiene varias filas con el mismo valor en `columna1`, usar `DISTINCT` devolverá cada valor único solo una vez.

```SQL
SELECT DISTINCT ciudad FROM clientes;
```

Este ejemplo mostrará la lista de ciudades sin repetición.

---

**Nota:** `DISTINCT` afecta a todas las columnas listadas en el `SELECT`.


## GROUP BY

La cláusula `GROUP BY` en SQL se utiliza para agrupar filas que tienen valores iguales en una o más columnas, permitiendo realizar funciones de agregación (como `COUNT`, `SUM`, `AVG`, etc.) sobre cada grupo.

### Uso básico

```sql
SELECT categoria, COUNT(*) AS total_productos
  FROM tb_productos_profe
 GROUP BY categoria;
```

### Funciones de agregación en Oracle

Las funciones de agregación realizan cálculos sobre un conjunto de filas y devuelven un solo valor resumen.

| Función    | Descripción                                             |
| ---------- | ------------------------------------------------------- |
| `COUNT`    | Cuenta el número de filas o valores no nulos.           |
| `SUM`      | Suma los valores de una columna numérica.               |
| `AVG`      | Calcula el promedio (media) de una columna numérica.    |
| `MIN`      | Devuelve el valor mínimo de una columna.                |
| `MAX`      | Devuelve el valor máximo de una columna.                |
| `STDDEV`   | Calcula la desviación estándar de una columna numérica. |
| `VARIANCE` | Calcula la varianza de una columna numérica.            |
| `LISTAGG`  | Concatenación de valores en una columna agrupados.      |

#### Ejemplo básico

```sql
SELECT categoria,
       COUNT(*) AS total_productos,
       AVG(precio) AS precio_medio,
       MAX(precio) AS precio_maximo
  FROM tb_productos_profe
 GROUP BY categoria;
 ```

### Con múltiples columnas ≠ Producto cartesiano

Cuando se utiliza `GROUP BY` con varias columnas en SQL (incluido Oracle), no se genera un producto cartesiano. En su lugar, los registros se agrupan por las combinaciones únicas existentes de los valores en esas columnas.

#### Ejemplo

```sql
SELECT categoria, estado, COUNT(*)
FROM productos
GROUP BY categoria, estado;
```

#### Datos de ejemplo

|categoria|estado|
|---|---|
|TECNOLOGIA|ACTIVO|
|TECNOLOGIA|ACTIVO|
|HOGAR|INACTIVO|
|HOGAR|ACTIVO|
|DEPORTE|ACTIVO|
#### Combinaciones únicas resultantes

El `GROUP BY` agrupará por:

- (TECNOLOGIA, ACTIVO)
    
- (HOGAR, INACTIVO)
    
- (HOGAR, ACTIVO)
    
- (DEPORTE, ACTIVO)
    

#### ¿Es un producto cartesiano?

No.

Un producto cartesiano generaría todas las combinaciones posibles entre los valores únicos de `categoria` y `estado`, incluso si no existen en los datos (por ejemplo, TECNOLOGIA + INACTIVO, aunque no aparezca en la tabla).

#### Conclusión

- `GROUP BY col1, col2` agrupa por combinaciones realmente presentes en los datos.
    
- No genera un producto cartesiano.
    
- El número de filas en el resultado depende únicamente de las combinaciones únicas encontradas.


## Proyección en SQL

**Proyección** es un concepto del modelo relacional que se refiere a la operación de seleccionar columnas específicas de una tabla. En SQL, se realiza usando la cláusula `SELECT` para devolver únicamente los atributos deseados.

### Definición

> Proyección: operación que devuelve solo ciertas columnas (atributos) de una tabla, descartando las demás.

### Ejemplo

```SQL
SELECT nombre, precio
FROM productos;
```

En este ejemplo, se está proyectando únicamente las columnas `nombre` y `precio` de la tabla `productos`.

### No confundir con:

- **Selección**: operación que filtra filas (`WHERE`).
    
- **Agregación**: operación que agrupa y calcula (`GROUP BY`, `SUM`, `AVG`, etc.).
    

### Ventajas

- Reduce la cantidad de datos devueltos.
    
- Mejora la eficiencia de las consultas.
    
- Facilita la lectura y uso de los resultados.

## Proyección vs Selección en SQL

En el contexto de bases de datos y SQL, **proyección** y **selección** son dos conceptos fundamentales para consultar datos.

### Proyección

- Se refiere a **elegir las columnas** que quieres mostrar en el resultado.
- En SQL, esto se hace especificando las columnas en la cláusula `SELECT`.
- Ejemplo:

```sql
SELECT nombre, salario
FROM empleados;
```

## ORDER BY

La cláusula `ORDER BY` en SQL se utiliza para ordenar los resultados de una consulta según una o varias columnas, ya sea en orden ascendente (`ASC`) o descendente (`DESC`).

### Sintaxis básica

```sql
SELECT columna1, columna2, ...
FROM tabla
ORDER BY columna1 [ASC|DESC], columna2 [ASC|DESC], ...;
```

Este ejemplo ordena primero por `salario` de mayor a menor y luego por `nombre` en orden alfabético ascendente.

### Notas

- Por defecto, si no se especifica `ASC` o `DESC`, el orden es ascendente (`ASC`).
    
- Puedes ordenar por columnas no seleccionadas en el `SELECT` si están en la tabla.
    
- También puedes ordenar por expresiones o alias de columnas.


# Función TRUNC en Oracle

La función `TRUNC` en Oracle se utiliza para **truncar valores**, ya sea fechas o números, eliminando las partes menos significativas sin redondear.

---

## TRUNC en Fechas

### Sintaxis

```SQL
TRUNC(fecha [, formato])
```

- `fecha`: valor de tipo fecha.
    
- `formato` (opcional): cadena que especifica el nivel de truncamiento.
    

### Formatos comunes para truncar fechas

|Formato|Descripción|
|---|---|
|`'dd'`|Trunca la fecha a la medianoche del día (default)|
|`'mm'`|Trunca al primer día del mes|
|`'yy'`|Trunca al primer día del año|
|`'qq'`|Trunca al primer día del trimestre|

### Ejemplos

```SQL
SELECT TRUNC(SYSDATE) AS dia_actual,
       TRUNC(SYSDATE, 'mm') AS primer_dia_mes,
       TRUNC(SYSDATE, 'yy') AS primer_dia_ano,
       TRUNC(SYSDATE, 'qq') AS primer_dia_trimestre
FROM dual;
```

---

## TRUNC en Números

### Sintaxis

```SQL
TRUNC(numero [, decimales])
```

- `numero`: valor numérico a truncar.
    
- `decimales` (opcional): número de posiciones decimales a mantener (puede ser negativo).
    

### Descripción

La función elimina los decimales adicionales sin redondear.

### Ejemplos

```SQL
SELECT TRUNC(123.4567) AS trunc_sin_decimales,
       TRUNC(123.4567, 2) AS trunc_dos_decimales,
       TRUNC(123.4567, 0) AS trunc_cero_decimales,
       TRUNC(123.4567, -1) AS trunc_decena
FROM dual;
```

Resultados:

|Expresión|Resultado|
|---|---|
|`TRUNC(123.4567)`|123|
|`TRUNC(123.4567, 2)`|123.45|
|`TRUNC(123.4567, 0)`|123|
|`TRUNC(123.4567, -1)`|120|



## Apache Spark

**Apache Spark** es un motor de procesamiento de datos distribuido y de código abierto diseñado para manejar grandes volúmenes de datos (Big Data) de forma rápida y eficiente.

---

### Características principales

- **Procesamiento en memoria:** Spark almacena los datos en memoria RAM, lo que hace que las operaciones sean mucho más rápidas comparadas con sistemas que usan solo disco.
    
- **Escalabilidad:** Puede ejecutarse en clusters con miles de nodos, procesando terabytes o petabytes de datos.
    
- **Multilenguaje:** Ofrece APIs para trabajar en Scala, Python (PySpark), Java y R.
    
- **Múltiples módulos:** Incluye componentes para procesamiento por lotes (batch), procesamiento en tiempo real (streaming), aprendizaje automático (MLlib), y consultas SQL (Spark SQL).
    
- **Integración con múltiples fuentes de datos:** Se conecta con sistemas de archivos (HDFS, S3), bases de datos, NoSQL, y más.
    

---

### Casos de uso típicos

- Análisis de datos a gran escala.
    
- Procesamiento ETL (extracción, transformación y carga).
    
- Machine learning y data science.
    
- Procesamiento de flujos en tiempo real.
    
- Integración y análisis de datos heterogéneos.
    

---

### Cómo funciona (resumen)

- Los datos se representan como **RDDs (Resilient Distributed Datasets)** o **DataFrames**.
    
- Las tareas se dividen en pequeños trabajos que se distribuyen entre los nodos del cluster.
    
- Utiliza DAGs (Grafos Acíclicos Dirigidos) para optimizar el plan de ejecución.